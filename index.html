<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é”€å”®æ™ºåº“</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* æ ·å¼åŒºä¿æŒä¸å˜ */
        :root { --primary: #2563eb; --bg: #f1f5f9; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: #333; margin: 0; padding: 20px; padding-top: 70px; }
        .search-box { position: fixed; top: 0; left: 0; right: 0; z-index: 50; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 12px 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); display: flex; gap: 12px; align-items: center; }
        .search-input { flex: 1; border: none; background: #f1f5f9; padding: 12px 16px; border-radius: 20px; font-size: 15px; }
        .search-input:focus { outline: 2px solid var(--primary); background: #fff; }
        .add-btn { background: var(--primary); color: #fff; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 26px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .filter-scroll { display: flex; gap: 10px; overflow-x: auto; padding: 5px 0 15px 0; -webkit-overflow-scrolling: touch; }
        .filter-scroll::-webkit-scrollbar { display: none; }
        .filter-btn { white-space: nowrap; padding: 8px 16px; border-radius: 20px; font-size: 13px; background: #fff; border: 1px solid #e2e8f0; color: #64748b; transition: 0.2s; }
        .filter-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); font-weight: 600; }
        .card { background: #fff; border-radius: 16px; padding: 18px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.02); position: relative; }
        .delete-btn { position: absolute; top: 15px; right: 15px; color: #cbd5e1; font-size: 16px; padding: 5px; z-index: 2; }
        .card-tag { font-size: 11px; padding: 4px 10px; border-radius: 6px; margin-bottom: 10px; display: inline-block; font-weight: 700; }
        .tag-æˆäº¤æ¡ˆä¾‹ { background: #dcfce7; color: #166534; } .tag-å¤§å•æ€è·¯ { background: #fef9c3; color: #854d0e; } .tag-ç–‘è™‘è§£ç­” { background: #fee2e2; color: #991b1b; } .tag-è¯æœ¯æŠ€å·§ { background: #dbeafe; color: #1e40af; }
        .card-title { font-size: 17px; font-weight: 700; color: #1e293b; margin-bottom: 8px; }
        .card-content { font-size: 14px; color: #64748b; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.6; }
        .card-footer { margin-top: 12px; font-size: 12px; color: #94a3b8; display: flex; justify-content: space-between; border-top: 1px solid #f1f5f9; padding-top: 10px;}
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 100; display: none; align-items: flex-end; }
        .modal { background: #fff; width: 100%; height: 85vh; border-radius: 24px 24px 0 0; padding: 25px; overflow-y: auto; }
        .form-control { width: 100%; padding: 14px; margin-bottom: 15px; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 16px; background: #f8fafc; }
        textarea.form-control { height: 180px; resize: none; line-height: 1.6; }
        .btn-block { width: 100%; padding: 16px; background: var(--primary); color: #fff; border:none; border-radius: 12px; font-size: 16px; font-weight: 700; }
        .loading { text-align: center; padding: 60px 20px; color: #94a3b8; font-size: 14px; }
        #statusLog { color: red; font-size: 12px; text-align: center; margin-top: 10px; white-space: pre-wrap;}
    </style>
</head>
<body>
    <div class="search-box">
        <input type="text" class="search-input" placeholder="ğŸ” æœé—®é¢˜..." id="searchInput" oninput="renderList()">
        <button class="add-btn" onclick="openModal('addModal')">+</button>
    </div>

    <div class="filter-scroll">
        <div class="filter-btn active" onclick="setFilter('all', this)">å…¨éƒ¨</div>
        <div class="filter-btn" onclick="setFilter('ç–‘è™‘è§£ç­”', this)">â“ ç–‘è™‘è§£ç­”</div>
        <div class="filter-btn" onclick="setFilter('æˆäº¤æ¡ˆä¾‹', this)">ğŸ† æˆäº¤æ¡ˆä¾‹</div>
        <div class="filter-btn" onclick="setFilter('å¤§å•æ€è·¯', this)">ğŸ’ å¤§å•æ€è·¯</div>
        <div class="filter-btn" onclick="setFilter('è¯æœ¯æŠ€å·§', this)">ğŸ—£ï¸ è¯æœ¯æŠ€å·§</div>
    </div>

    <div id="gridContainer">
        <div class="loading">ğŸš€ æ­£åœ¨ç›´è¿äº‘ç«¯...</div>
    </div>
    <div id="statusLog"></div>

    <div class="modal-overlay" id="addModal">
        <div class="modal">
            <h2 style="margin:0 0 25px 0;">ğŸ“ å‘å¸ƒ</h2>
            <select class="form-control" id="inputType"><option>ç–‘è™‘è§£ç­”</option><option>æˆäº¤æ¡ˆä¾‹</option><option>å¤§å•æ€è·¯</option><option>è¯æœ¯æŠ€å·§</option></select>
            <input type="text" class="form-control" id="inputTitle" placeholder="æ ‡é¢˜">
            <textarea class="form-control" id="inputContent" placeholder="å†…å®¹"></textarea>
            <input type="text" class="form-control" id="inputAuthor" placeholder="åˆ†äº«äºº">
            <button class="btn-block" onclick="saveData()">å‘å¸ƒ</button>
            <button onclick="closeModal('addModal')" style="width:100%; padding:15px; margin-top:10px; border:none; background:none; color:#999">å…³é—­</button>
        </div>
    </div>

    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <h2 id="detailTitle" style="margin:0 0 15px 0;"></h2>
            <div id="detailContent" class="detail-content" style="font-size:16px; line-height:1.6; color:#333; margin-bottom:30px; white-space: pre-wrap;"></div>
            <button class="btn-block" onclick="closeModal('detailModal')">å…³é—­</button>
        </div>
    </div>

<script>
    // ğŸ”‘ ä½ çš„é’¥åŒ™ (ä»æˆªå›¾ image_7080d8.png æå–)
    const APP_ID = '711a5754d90f2ed8dcafc8ebb1b640cd';
    const REST_KEY = '440f810266f7e9b5a3e50b59480d7e2e';
    
    // API åŸºç¡€åœ°å€
    const BASE_URL = 'https://api.bmobcloud.com/1/classes/SalesData';

    let allData = [];
    let currentFilter = 'all';

    // 1. åŸç”Ÿç½‘ç»œè¯·æ±‚å‡½æ•° (ä¸ä¾èµ–ä»»ä½• SDK)
    async function apiRequest(method, url, body = null) {
        const headers = {
            'X-Bmob-Application-Id': APP_ID,
            'X-Bmob-REST-API-Key': REST_KEY,
            'Content-Type': 'application/json'
        };
        const options = { method, headers };
        if (body) options.body = JSON.stringify(body);

        try {
            const response = await fetch(url, options);
            if (!response.ok) {
                const errText = await response.text();
                throw new Error(`è¯·æ±‚å¤±è´¥: ${response.status} - ${errText}`);
            }
            return await response.json();
        } catch (error) {
            document.getElementById('statusLog').innerText = "âŒ ç½‘ç»œé”™è¯¯: " + error.message;
            throw error;
        }
    }

    // 2. åŠ è½½æ•°æ®
    async function loadData() {
        try {
            // æŒ‰æ—¶é—´å€’åºå–500æ¡
            const res = await apiRequest('GET', `${BASE_URL}?order=-createdAt&limit=500`);
            allData = res.results || [];
            renderList();
        } catch (e) {
            console.error(e);
        }
    }

    // 3. å‘å¸ƒæ•°æ®
    async function saveData() {
        const title = document.getElementById('inputTitle').value;
        const content = document.getElementById('inputContent').value;
        if(!title || !content) return alert('è¯·å¡«å†™å®Œæ•´');

        const data = {
            type: document.getElementById('inputType').value,
            title: title,
            content: content,
            author: document.getElementById('inputAuthor').value || "åŒ¿å"
        };

        try {
            await apiRequest('POST', BASE_URL, data);
            alert('âœ… å‘å¸ƒæˆåŠŸï¼');
            closeModal('addModal');
            document.getElementById('inputTitle').value = '';
            document.getElementById('inputContent').value = '';
            loadData(); // åˆ·æ–°
        } catch (e) {
            alert('å‘å¸ƒå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
        }
    }

    // 4. åˆ é™¤æ•°æ®
    async function deleteItem(id) {
        if(!confirm('ç¡®å®šåˆ é™¤?')) return;
        try {
            await apiRequest('DELETE', `${BASE_URL}/${id}`);
            loadData();
        } catch (e) {
            alert('åˆ é™¤å¤±è´¥');
        }
    }

    // 5. æ¸²æŸ“é€»è¾‘
    function renderList() {
        const container = document.getElementById('gridContainer');
        const searchVal = (document.getElementById('searchInput').value || '').toLowerCase();
        
        const filtered = allData.filter(item => {
            const matchType = currentFilter === 'all' || item.type === currentFilter;
            const matchSearch = (item.title||'').toLowerCase().includes(searchVal) || (item.content||'').toLowerCase().includes(searchVal);
            return matchType && matchSearch;
        });

        container.innerHTML = '';
        if(filtered.length === 0) { 
            container.innerHTML = `<div class="loading">æš‚æ— å†…å®¹<br>ç‚¹å‡»å³ä¸Šè§’ + å‘å¸ƒ</div>`; 
            return; 
        }

        filtered.forEach(item => {
            let tagColor = ''; 
            if(item.type==='æˆäº¤æ¡ˆä¾‹') tagColor='tag-æˆäº¤æ¡ˆä¾‹';
            if(item.type==='å¤§å•æ€è·¯') tagColor='tag-å¤§å•æ€è·¯';
            
            const div = document.createElement('div');
            div.className = 'card';
            div.onclick = (e) => { if(e.target.className !== 'delete-btn') openDetail(item); };
            div.innerHTML = `
                <div class="delete-btn" onclick="deleteItem('${item.objectId}')">ğŸ—‘ï¸</div>
                <span class="card-tag ${tagColor} tag-${item.type}">${item.type}</span>
                <div class="card-title">${item.title}</div>
                <div class="card-content">${item.content}</div>
                <div class="card-footer" style="margin-top:10px; font-size:12px; color:#999;">
                    <span>ğŸ‘¤ ${item.author||'åŒ¿å'}</span>
                    <span>${item.createdAt.split(' ')[0]}</span>
                </div>
            `;
            container.appendChild(div);
        });
    }

    function openDetail(item) {
        document.getElementById('detailTitle').innerText = item.title;
        document.getElementById('detailContent').innerText = item.content;
        openModal('detailModal');
    }
    
    function setFilter(t, btn) { 
        currentFilter = t; 
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); 
        btn.classList.add('active'); 
        renderList(); 
    }
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    // å¯åŠ¨
    loadData();
</script>
</body>
</html>
