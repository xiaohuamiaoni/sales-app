<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<title>é”€å”®æ™ºåº“ Â· å›¢é˜Ÿç‰ˆ</title>

<style>
:root { --primary:#2563eb; --bg:#f1f5f9; }
*{box-sizing:border-box;}
body{
    margin:0;padding:70px 20px 20px;
    font-family:-apple-system,BlinkMacSystemFont,sans-serif;
    background:var(--bg);color:#333;
}
.search-box{
    position:fixed;top:0;left:0;right:0;z-index:50;
    background:rgba(255,255,255,.95);
    backdrop-filter:blur(10px);
    padding:12px 20px;display:flex;gap:10px;
    box-shadow:0 4px 20px rgba(0,0,0,.05);
}
.search-input{
    flex:1;border:none;background:#f1f5f9;
    padding:12px 16px;border-radius:20px;
}
.add-btn{
    width:40px;height:40px;border-radius:50%;
    border:none;background:var(--primary);
    color:#fff;font-size:22px;
    display:none;
}
.admin-btn{
    border:none;background:#e2e8f0;
    border-radius:20px;padding:10px 14px;
    font-size:13px;
}
.filter-scroll{
    display:flex;gap:10px;overflow-x:auto;
    padding-bottom:15px;
}
.filter-btn{
    padding:8px 16px;border-radius:20px;
    background:#fff;border:1px solid #e2e8f0;
    font-size:13px;white-space:nowrap;
}
.filter-btn.active{
    background:var(--primary);color:#fff;
    border-color:var(--primary);
}
.card{
    background:#fff;border-radius:16px;
    padding:18px;margin-bottom:15px;
    box-shadow:0 2px 8px rgba(0,0,0,.03);
    position:relative;
}
.delete-btn{
    position:absolute;top:12px;right:12px;
    font-size:16px;color:#cbd5e1;
}
.card-tag{
    font-size:11px;font-weight:700;
    padding:4px 10px;border-radius:6px;
    display:inline-block;margin-bottom:8px;
}
.tag-ç–‘è™‘è§£ç­”{background:#fee2e2;color:#991b1b;}
.tag-æˆäº¤æ¡ˆä¾‹{background:#dcfce7;color:#166534;}
.tag-å¤§å•æ€è·¯{background:#fef9c3;color:#854d0e;}
.tag-è¯æœ¯æŠ€å·§{background:#dbeafe;color:#1e40af;}
.card-title{font-size:17px;font-weight:700;margin-bottom:6px;}
.card-content{
    font-size:14px;color:#64748b;
    line-height:1.6;
    display:-webkit-box;
    -webkit-line-clamp:2;
    -webkit-box-orient:vertical;
    overflow:hidden;
}
.card-footer{
    margin-top:10px;font-size:12px;color:#94a3b8;
    display:flex;justify-content:space-between;
}
.modal-overlay{
    position:fixed;inset:0;
    background:rgba(0,0,0,.6);
    display:none;align-items:flex-end;
    z-index:100;
}
.modal{
    background:#fff;width:100%;
    height:85vh;border-radius:24px 24px 0 0;
    padding:25px;overflow-y:auto;
}
.form-control{
    width:100%;padding:14px;margin-bottom:12px;
    border-radius:12px;border:1px solid #e2e8f0;
}
textarea.form-control{height:200px;}
.btn-block{
    width:100%;padding:16px;
    background:var(--primary);
    color:#fff;border:none;
    border-radius:12px;font-weight:700;
}
.loading{text-align:center;color:#94a3b8;padding:60px;}
</style>
</head>

<body>

<div class="search-box">
    <input id="searchInput" class="search-input" placeholder="ğŸ” æœé—®é¢˜â€¦" oninput="renderList()" />
    <button class="admin-btn" onclick="adminLogin()">ğŸ” ç®¡ç†</button>
    <button id="addBtn" class="add-btn" onclick="openModal('addModal')">+</button>
</div>

<div class="filter-scroll">
    <div class="filter-btn active" onclick="setFilter('all',this)">å…¨éƒ¨</div>
    <div class="filter-btn" onclick="setFilter('ç–‘è™‘è§£ç­”',this)">ç–‘è™‘è§£ç­”</div>
    <div class="filter-btn" onclick="setFilter('æˆäº¤æ¡ˆä¾‹',this)">æˆäº¤æ¡ˆä¾‹</div>
    <div class="filter-btn" onclick="setFilter('å¤§å•æ€è·¯',this)">å¤§å•æ€è·¯</div>
    <div class="filter-btn" onclick="setFilter('è¯æœ¯æŠ€å·§',this)">è¯æœ¯æŠ€å·§</div>
</div>

<div id="gridContainer"><div class="loading">åŠ è½½ä¸­â€¦</div></div>

<!-- å‘å¸ƒ -->
<div class="modal-overlay" id="addModal">
<div class="modal">
<h2>å‘å¸ƒå†…å®¹</h2>
<select id="inputType" class="form-control" onchange="fillTemplate()">
<option>ç–‘è™‘è§£ç­”</option>
<option>æˆäº¤æ¡ˆä¾‹</option>
<option>å¤§å•æ€è·¯</option>
<option>è¯æœ¯æŠ€å·§</option>
</select>
<input id="inputTitle" class="form-control" placeholder="æ ‡é¢˜">
<textarea id="inputContent" class="form-control" placeholder="å†…å®¹"></textarea>
<input id="inputAuthor" class="form-control" placeholder="åˆ†äº«äºº">
<button class="btn-block" onclick="saveData()">å‘å¸ƒ</button>
<button onclick="closeModal('addModal')" class="btn-block" style="background:#e2e8f0;color:#333;margin-top:10px;">å…³é—­</button>
</div>
</div>

<!-- è¯¦æƒ… -->
<div class="modal-overlay" id="detailModal">
<div class="modal">
<h2 id="detailTitle"></h2>
<pre id="detailContent" style="white-space:pre-wrap;font-size:15px;line-height:1.6;"></pre>
<button class="btn-block" onclick="closeModal('detailModal')">å…³é—­</button>
</div>
</div>

<script>
/* ====== é…ç½® ====== */
const APP_ID='711a5754d90f2ed8dcafc8ebb1b640cd';
const REST_KEY='440f810266f7e9b5a3e50b59480d7e2e';
const BASE_URL='https://api.bmobcloud.com/1/classes/SalesData';
const ADMIN_PASSWORD='123456';

/* ====== æƒé™ ====== */
const IS_ADMIN = localStorage.getItem('isAdmin')==='1';
if(IS_ADMIN) document.getElementById('addBtn').style.display='flex';

/* ====== æ¨¡æ¿ ====== */
const templates={
'ç–‘è™‘è§£ç­”':`å®¢æˆ·åŸè¯ï¼š
æ ¸å¿ƒæ‹…å¿ƒï¼š
æ ‡å‡†å›åº”ï¼š
è¡¥å……è¯´æ˜ï¼š
é€‚ç”¨äººç¾¤ï¼š`,
'æˆäº¤æ¡ˆä¾‹':`å®¢æˆ·èƒŒæ™¯ï¼š
æˆäº¤äº§å“ï¼š
å…³é”®è½¬æŠ˜ç‚¹ï¼š
ç”¨åˆ°çš„è¯æœ¯ï¼š
å¤ç›˜æ€»ç»“ï¼š`,
'å¤§å•æ€è·¯':`é€‚åˆå®¢æˆ·ï¼š
æ ¸å¿ƒé€»è¾‘ï¼š
æ“ä½œæ­¥éª¤ï¼š
æ³¨æ„äº‹é¡¹ï¼š`,
'è¯æœ¯æŠ€å·§':`ä½¿ç”¨åœºæ™¯ï¼š
åŸè¯æœ¯ï¼š
ä¼˜åŒ–åè¯æœ¯ï¼š
ä¸ºä»€ä¹ˆè¿™æ ·è¯´ï¼š`
};

function fillTemplate(){
    document.getElementById('inputContent').value=
    templates[document.getElementById('inputType').value];
}

/* ====== ç®¡ç†å‘˜ ====== */
function adminLogin(){
    const pwd=prompt('è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ');
    if(pwd===ADMIN_PASSWORD){
        localStorage.setItem('isAdmin','1');
        location.reload();
    }else alert('å¯†ç é”™è¯¯');
}

/* ====== ç½‘ç»œ ====== */
async function apiRequest(method,url,body){
    const res=await fetch(url,{
        method,
        headers:{
            'X-Bmob-Application-Id':APP_ID,
            'X-Bmob-REST-API-Key':REST_KEY,
            'Content-Type':'application/json'
        },
        body:body?JSON.stringify(body):null
    });
    return res.json();
}

/* ====== æ•°æ® ====== */
let allData=[],currentFilter='all';

async function loadData(){
    const res=await apiRequest('GET',`${BASE_URL}?order=-createdAt&limit=500`);
    allData=res.results||[];
    renderList();
}

function renderList(){
    const kw=(searchInput.value||'').toLowerCase();
    const list=allData.filter(i=>{
        return (currentFilter==='all'||i.type===currentFilter)&&
        ((i.title||'').toLowerCase().includes(kw)||(i.content||'').toLowerCase().includes(kw));
    });
    gridContainer.innerHTML='';
    if(!list.length){gridContainer.innerHTML='<div class="loading">æš‚æ— å†…å®¹</div>';return;}
    list.forEach(i=>{
        const div=document.createElement('div');
        div.className='card';
        div.onclick=()=>openDetail(i);
        div.innerHTML=`
        ${IS_ADMIN?`<div class="delete-btn" onclick="event.stopPropagation();deleteItem('${i.objectId}')">ğŸ—‘ï¸</div>`:''}
        <span class="card-tag tag-${i.type}">${i.type}</span>
        <div class="card-title">${i.title}</div>
        <div class="card-content">${i.content}</div>
        <div class="card-footer">
        <span>${i.author||'åŒ¿å'}</span>
        <span>${new Date(i.createdAt).toLocaleDateString()}</span>
        </div>`;
        gridContainer.appendChild(div);
    });
}

async function saveData(){
    await apiRequest('POST',BASE_URL,{
        type:inputType.value,
        title:inputTitle.value,
        content:inputContent.value,
        author:inputAuthor.value||'åŒ¿å'
    });
    closeModal('addModal');
    loadData();
}

async function deleteItem(id){
    if(confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')){
        await apiRequest('DELETE',`${BASE_URL}/${id}`);
        loadData();
    }
}

function openDetail(i){
    detailTitle.innerText=i.title;
    detailContent.innerText=i.content;
    openModal('detailModal');
}

function setFilter(t,btn){
    currentFilter=t;
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    renderList();
}
function openModal(id){document.getElementById(id).style.display='flex';}
function closeModal(id){document.getElementById(id).style.display='none';}

loadData();
</script>

</body>
</html>
