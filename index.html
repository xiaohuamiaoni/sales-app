<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é”€å”®æ™ºåº“</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    
    <script src="https://cdn.jsdelivr.net/npm/bmob.js-sdk-pro@3.2.3/dist/model/bmob-min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* ================== æ ·å¼åŒºåŸŸ ================== */
        :root { --primary: #2563eb; --bg: #f1f5f9; --card-bg: #fff; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg); color: #333; margin: 0; padding: 20px; padding-top: 70px; /* ç•™å‡ºé¡¶éƒ¨æœç´¢æ é«˜åº¦ */
        }
        
        /* 1. é¡¶éƒ¨æœç´¢æ  (å¸é¡¶) */
        .search-box { 
            position: fixed; top: 0; left: 0; right: 0; z-index: 50; 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            padding: 12px 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            display: flex; gap: 12px; align-items: center;
        }
        .search-input { 
            flex: 1; border: none; background: #f1f5f9; padding: 12px 16px; 
            border-radius: 20px; font-size: 15px; color: #333;
        }
        .search-input:focus { outline: 2px solid var(--primary); background: #fff; }
        
        .add-btn {
            background: var(--primary); color: #fff; border: none; width: 40px; height: 40px; 
            border-radius: 50%; font-size: 26px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3); transition: transform 0.1s;
        }
        .add-btn:active { transform: scale(0.9); }

        /* 2. è¯Šæ–­ä¿¡æ¯æ¡† (ä»…åœ¨å‡ºé”™æ—¶æ˜¾ç¤º) */
        #debugLog { 
            background: #1e1e1e; color: #ff6b6b; padding: 15px; border-radius: 8px; 
            font-family: monospace; font-size: 13px; margin-bottom: 20px; 
            display: none; white-space: pre-wrap; border-left: 5px solid #ff4757;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        /* 3. åˆ†ç±»ç­›é€‰æ  */
        .filter-scroll { 
            display: flex; gap: 10px; overflow-x: auto; padding: 5px 0 15px 0;
            -webkit-overflow-scrolling: touch; /* iOSé¡ºæ»‘æ»šåŠ¨ */
        }
        .filter-scroll::-webkit-scrollbar { display: none; } /* éšè—æ»šåŠ¨æ¡ */
        .filter-btn { 
            white-space: nowrap; padding: 8px 16px; border-radius: 20px; font-size: 13px;
            background: #fff; border: 1px solid #e2e8f0; color: #64748b; transition: 0.2s;
        }
        .filter-btn.active { 
            background: var(--primary); color: #fff; border-color: var(--primary); 
            font-weight: 600; box-shadow: 0 2px 8px rgba(37, 99, 235, 0.2);
        }

        /* 4. å†…å®¹å¡ç‰‡ */
        .card { 
            background: #fff; border-radius: 16px; padding: 18px; margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.02); position: relative; transition: transform 0.1s;
            border: 1px solid rgba(0,0,0,0.02);
        }
        .card:active { transform: scale(0.98); background: #fafafa; }
        
        .delete-btn {
            position: absolute; top: 15px; right: 15px; color: #cbd5e1; 
            font-size: 16px; padding: 5px; z-index: 2;
        }
        
        .card-tag { 
            font-size: 11px; padding: 4px 10px; border-radius: 6px; margin-bottom: 10px; 
            display: inline-block; font-weight: 700; letter-spacing: 0.5px;
        }
        .tag-æˆäº¤æ¡ˆä¾‹ { background: #dcfce7; color: #166534; }
        .tag-å¤§å•æ€è·¯ { background: #fef9c3; color: #854d0e; }
        .tag-ç–‘è™‘è§£ç­” { background: #fee2e2; color: #991b1b; }
        .tag-è¯æœ¯æŠ€å·§ { background: #dbeafe; color: #1e40af; }

        .card-title { font-size: 17px; font-weight: 700; color: #1e293b; margin-bottom: 8px; line-height: 1.4; }
        .card-content { font-size: 14px; color: #64748b; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.6; }
        .card-footer { margin-top: 12px; font-size: 12px; color: #94a3b8; display: flex; justify-content: space-between; border-top: 1px solid #f1f5f9; padding-top: 10px;}

        /* 5. å¼¹çª—æ ·å¼ */
        .modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.6); z-index: 100; display: none; 
            align-items: flex-end; /* åº•éƒ¨å¼¹å‡º */
        }
        .modal { 
            background: #fff; width: 100%; height: 85vh; 
            border-radius: 24px 24px 0 0; padding: 25px; overflow-y: auto; 
            animation: slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .form-control { 
            width: 100%; padding: 14px; margin-bottom: 15px; 
            border: 1px solid #e2e8f0; border-radius: 12px; font-size: 16px; 
            background: #f8fafc; transition: 0.2s;
        }
        .form-control:focus { background: #fff; border-color: var(--primary); outline: none; }
        textarea.form-control { height: 180px; resize: none; line-height: 1.6; }
        
        .btn-block { 
            width: 100%; padding: 16px; background: var(--primary); color: #fff; 
            border:none; border-radius: 12px; font-size: 16px; font-weight: 700; 
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }
        .btn-close { width:100%; padding:15px; margin-top:10px; background:none; border:none; color:#94a3b8; font-size:14px; }

        .detail-content { font-size: 17px; line-height: 1.8; color: #333; white-space: pre-wrap; padding-bottom: 80px; }
        .loading { text-align: center; padding: 60px 20px; color: #94a3b8; font-size: 14px; }
    </style>
</head>
<body>

    <div class="search-box">
        <input type="text" class="search-input" placeholder="ğŸ” æœé—®é¢˜ã€è¯æœ¯..." id="searchInput" oninput="loadData()">
        <button class="add-btn" onclick="openModal('addModal')">+</button>
    </div>

    <div id="debugLog"></div>

    <div class="filter-scroll">
        <div class="filter-btn active" onclick="setFilter('all', this)">å…¨éƒ¨</div>
        <div class="filter-btn" onclick="setFilter('ç–‘è™‘è§£ç­”', this)">â“ ç–‘è™‘è§£ç­”</div>
        <div class="filter-btn" onclick="setFilter('æˆäº¤æ¡ˆä¾‹', this)">ğŸ† æˆäº¤æ¡ˆä¾‹</div>
        <div class="filter-btn" onclick="setFilter('å¤§å•æ€è·¯', this)">ğŸ’ å¤§å•æ€è·¯</div>
        <div class="filter-btn" onclick="setFilter('è¯æœ¯æŠ€å·§', this)">ğŸ—£ï¸ è¯æœ¯æŠ€å·§</div>
    </div>

    <div id="gridContainer">
        <div class="loading">
            ğŸš€ æ­£åœ¨è¿æ¥äº‘ç«¯...<br>
            <span style="font-size:12px; opacity:0.7">æ­£åœ¨å°è¯•é€šè¿‡ jsDelivr çº¿è·¯åŠ è½½</span>
        </div>
    </div>

    <div class="modal-overlay" id="addModal">
        <div class="modal">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                <h2 style="margin:0; font-size:22px;">ğŸ“ å‘å¸ƒæ–°ç»éªŒ</h2>
                <span onclick="closeModal('addModal')" style="font-size:28px; color:#cbd5e1; padding:5px;">&times;</span>
            </div>
            
            <select class="form-control" id="inputType">
                <option>ç–‘è™‘è§£ç­”</option>
                <option>æˆäº¤æ¡ˆä¾‹</option>
                <option>å¤§å•æ€è·¯</option>
                <option>è¯æœ¯æŠ€å·§</option>
            </select>
            
            <input type="text" class="form-control" id="inputTitle" placeholder="æ ‡é¢˜ï¼ˆä¾‹å¦‚ï¼šå®¢æˆ·å«Œè´µæ€ä¹ˆå›ï¼Ÿï¼‰">
            <textarea class="form-control" id="inputContent" placeholder="åœ¨æ­¤è¾“å…¥è¯¦ç»†çš„å†…å®¹..."></textarea>
            <input type="text" class="form-control" id="inputAuthor" placeholder="åˆ†äº«äººå§“å">
            
            <button class="btn-block" onclick="saveData()">ç«‹å³å‘å¸ƒ</button>
            <button class="btn-close" onclick="closeModal('addModal')">å–æ¶ˆ</button>
        </div>
    </div>

    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <span class="card-tag" id="detailTag">ç±»å‹</span>
                <span onclick="closeModal('detailModal')" style="font-size:28px; color:#cbd5e1;">&times;</span>
            </div>
            
            <h2 id="detailTitle" style="margin:0 0 15px 0; font-size:22px; line-height:1.4;"></h2>
            
            <div style="font-size:13px; color:#94a3b8; border-bottom:1px solid #f1f5f9; padding-bottom:15px; margin-bottom:25px; display:flex; gap:15px;">
                <span>ğŸ‘¤ <span id="detailAuthor"></span></span>
                <span>ğŸ•’ <span id="detailTime"></span></span>
            </div>
            
            <div id="detailContent" class="detail-content"></div>
            
            <div style="position:fixed; bottom:30px; left:25px; right:25px;">
                <button class="btn-block" onclick="copyDetail()">ğŸ“‹ ä¸€é”®å¤åˆ¶å†…å®¹</button>
            </div>
        </div>
    </div>

<script>
    // ==========================================
    // ğŸ”‘ æ ¸å¿ƒé…ç½®åŒº (å·²ç¡®è®¤æ— è¯¯)
    // ==========================================
    const SECRET_KEY = '807e472419b69803';
    // ä½¿ç”¨ Master Key (è¶…çº§é’¥åŒ™) æ¥è·³è¿‡æƒé™æ£€æŸ¥
    const MASTER_KEY = 'a5ec18cdd45c00de7829376b9c37fc5b'; 

    // æ—¥å¿—è¾…åŠ©å‡½æ•° (å‡ºé”™æ—¶æ˜¾ç¤ºçº¢æ¡†)
    function log(msg) {
        console.error(msg);
        const box = document.getElementById('debugLog');
        box.style.display = 'block';
        box.innerText = "ã€ç³»ç»Ÿè¯Šæ–­æ—¥å¿—ã€‘\n" + msg;
    }

    // 1. åˆå§‹åŒ– Bmob
    try {
        // ä½¿ç”¨è¶…çº§é’¥åŒ™åˆå§‹åŒ–ï¼Œç¡®ä¿æƒé™ç•…é€š
        Bmob.initialize(SECRET_KEY, MASTER_KEY);
        console.log("Bmob SDK init success");
    } catch (e) {
        // å¦‚æœè¿™é‡ŒæŠ¥é”™ï¼Œè¯´æ˜ SDK æ–‡ä»¶æ ¹æœ¬æ²¡åŠ è½½ä¸‹æ¥ï¼ˆç½‘ç»œé—®é¢˜ï¼‰
        log("âŒ SDKåŠ è½½å¤±è´¥ï¼\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæˆ–è€…æ‚¨æ‰€åœ¨ç½‘ç»œå±è”½äº† jsDelivr CDNã€‚\n\nè§£å†³æ–¹æ³•ï¼šå°è¯•åˆ‡æ¢æ‰‹æœº4G/5Gç½‘ç»œè®¿é—®ã€‚");
    }

    let allData = [];
    let currentFilter = 'all';

    // 2. åŠ è½½æ•°æ®
    function loadData() {
        // åªæœ‰ Bmob å®šä¹‰äº†æ‰èƒ½è·‘
        if (typeof Bmob === 'undefined') return;

        const query = Bmob.Query("SalesData");
        query.order("-createdAt");
        query.limit(500);
        
        query.find().then(res => {
            if(Array.isArray(res)){ 
                allData = res; 
                renderList(); 
            }
        }).catch(err => {
            log("âŒ è¿æ¥äº‘ç«¯å¤±è´¥: " + JSON.stringify(err));
        });
    }

    // 3. æ¸²æŸ“åˆ—è¡¨
    function renderList() {
        const container = document.getElementById('gridContainer');
        const searchVal = document.getElementById('searchInput').value.toLowerCase();
        
        const filtered = allData.filter(item => {
            const matchType = currentFilter === 'all' || item.type === currentFilter;
            const matchSearch = (item.title||'').toLowerCase().includes(searchVal) || (item.content||'').toLowerCase().includes(searchVal);
            return matchType && matchSearch;
        });

        container.innerHTML = '';
        if(filtered.length === 0) { 
            container.innerHTML = `<div class="loading">æš‚æ— å†…å®¹<br>ç‚¹å‡»å³ä¸Šè§’ + å·å‘å¸ƒç¬¬ä¸€æ¡ç»éªŒ</div>`; 
            return; 
        }

        filtered.forEach(item => {
            const dateStr = item.createdAt ? item.createdAt.split(' ')[0] : 'åˆšåˆš';
            let tagColor = ''; 
            if(item.type==='æˆäº¤æ¡ˆä¾‹') tagColor='tag-æˆäº¤æ¡ˆä¾‹';
            if(item.type==='å¤§å•æ€è·¯') tagColor='tag-å¤§å•æ€è·¯';
            if(item.type==='ç–‘è™‘è§£ç­”') tagColor='tag-ç–‘è™‘è§£ç­”';
            if(item.type==='è¯æœ¯æŠ€å·§') tagColor='tag-è¯æœ¯æŠ€å·§';
            
            const div = document.createElement('div'); 
            div.className = 'card';
            div.onclick = (e) => { 
                if(e.target.className !== 'delete-btn') openDetail(item); 
            };
            
            div.innerHTML = `
                <div class="delete-btn" onclick="deleteItem('${item.objectId}')">ğŸ—‘ï¸</div>
                <span class="card-tag ${tagColor}">${item.type}</span>
                <div class="card-title">${item.title}</div>
                <div class="card-content">${item.content}</div>
                <div class="card-footer">
                    <span>ğŸ‘¤ ${item.author||'åŒ¿å'}</span>
                    <span>${dateStr}</span>
                </div>
            `;
            container.appendChild(div);
        });
    }
    
    // 4. ä¿å­˜æ•°æ®
    function saveData() {
        const t = document.getElementById('inputTitle').value;
        const c = document.getElementById('inputContent').value;
        if(!t || !c) return alert('æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©º');

        const query = Bmob.Query('SalesData');
        query.set("type", document.getElementById('inputType').value);
        query.set("title", t);
        query.set("content", c);
        query.set("author", document.getElementById('inputAuthor').value || "åŒ¿å");
        
        query.save().then(res => { 
            alert('âœ… å‘å¸ƒæˆåŠŸï¼'); 
            closeModal('addModal'); 
            document.getElementById('inputTitle').value=''; 
            document.getElementById('inputContent').value=''; 
            // æˆåŠŸåéšè—å¯èƒ½å­˜åœ¨çš„é”™è¯¯æ¡†
            document.getElementById('debugLog').style.display = 'none';
            loadData(); 
        }).catch(err => {
            alert('å‘å¸ƒå¤±è´¥');
            log("âŒ å‘å¸ƒå¤±è´¥è¯¦æƒ…: " + JSON.stringify(err));
        });
    }
    
    // 5. å…¶ä»–åŠŸèƒ½
    function deleteItem(id) { 
        if(confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å†…å®¹å—ï¼Ÿ')) {
            Bmob.Query('SalesData').destroy(id).then(()=>loadData()); 
        }
    }
    
    function openDetail(item) {
        const t = document.getElementById('detailTag'); 
        t.innerText = item.type; 
        t.className = `card-tag tag-${item.type}`;
        
        document.getElementById('detailTitle').innerText = item.title; 
        document.getElementById('detailAuthor').innerText = item.author||'åŒ¿å';
        document.getElementById('detailTime').innerText = item.createdAt; 
        document.getElementById('detailContent').innerText = item.content;
        openModal('detailModal');
    }
    
    function copyDetail() { 
        const text = document.getElementById('detailContent').innerText;
        navigator.clipboard.writeText(text).then(()=>alert('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')); 
    }
    
    function setFilter(type, btn) { 
        currentFilter = type; 
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); 
        btn.classList.add('active'); 
        renderList(); 
    }
    
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    
    // å¯åŠ¨
    loadData();
</script>
</body>
</html>
