<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é”€å”®æ™ºåº“</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://unpkg.com/bmob.js-sdk-pro@3.2.3/dist/model/bmob-min.js"></script> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: #333; margin: 0; padding: 20px; padding-top: 60px; }
        
        /* ğŸ”´ è¯Šæ–­æ¡†æ ·å¼ (åªæœ‰å‡ºé”™æ—¶æ‰ä¼šå¼•èµ·æ³¨æ„) */
        #debugLog { 
            background: #000; color: #0f0; padding: 10px; border-radius: 8px; 
            font-family: monospace; font-size: 12px; margin-bottom: 20px; 
            display: none; white-space: pre-wrap; border: 2px solid red;
        }

        .search-box { position: fixed; top: 0; left: 0; right: 0; z-index: 50; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 10px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; gap: 10px; align-items: center; }
        .search-input { flex: 1; border: none; background: #f1f5f9; padding: 10px 15px; border-radius: 20px; font-size: 15px; }
        .add-btn { background: var(--primary); color: #fff; border: none; width: 36px; height: 36px; border-radius: 50%; font-size: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        
        .card { background: #fff; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); position: relative; }
        .card-tag { font-size: 10px; padding: 3px 8px; border-radius: 4px; margin-bottom: 8px; display: inline-block; font-weight: bold;}
        .tag-æˆäº¤æ¡ˆä¾‹ { background: #dcfce7; color: #166534; } .tag-å¤§å•æ€è·¯ { background: #fef9c3; color: #854d0e; } .tag-ç–‘è™‘è§£ç­” { background: #fee2e2; color: #991b1b; } .tag-è¯æœ¯æŠ€å·§ { background: #dbeafe; color: #1e40af; }
        .card-title { font-size: 16px; font-weight: 700; color: #1e293b; margin-bottom: 6px; }
        .card-content { font-size: 14px; color: #64748b; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 100; display: none; align-items: flex-end; }
        .modal { background: #fff; width: 100%; height: 85vh; border-radius: 20px 20px 0 0; padding: 25px; overflow-y: auto; }
        .form-control { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 16px; background: #f8fafc; }
        .btn-block { width: 100%; padding: 14px; background: var(--primary); color: #fff; border:none; border-radius: 10px; font-size: 16px; font-weight: bold; }
        .loading { text-align: center; padding: 50px; color: #94a3b8; }
    </style>
</head>
<body>

    <div class="search-box">
        <input type="text" class="search-input" placeholder="ğŸ”..." id="searchInput" oninput="loadData()">
        <button class="add-btn" onclick="openModal('addModal')">+</button>
    </div>

    <div id="debugLog"></div>

    <div id="gridContainer">
        <div class="loading">ğŸš€ æ­£åœ¨è¿æ¥...</div>
    </div>

    <div class="modal-overlay" id="addModal">
        <div class="modal">
            <h3>ğŸ“ å‘å¸ƒæ–°ç»éªŒ</h3>
            <select class="form-control" id="inputType"><option>ç–‘è™‘è§£ç­”</option><option>æˆäº¤æ¡ˆä¾‹</option><option>å¤§å•æ€è·¯</option><option>è¯æœ¯æŠ€å·§</option></select>
            <input type="text" class="form-control" id="inputTitle" placeholder="æ ‡é¢˜">
            <textarea class="form-control" id="inputContent" placeholder="è¯¦ç»†å†…å®¹" style="height:150px"></textarea>
            <input type="text" class="form-control" id="inputAuthor" placeholder="åˆ†äº«äºº">
            <button class="btn-block" onclick="saveData()">å‘å¸ƒ</button>
            <button onclick="closeModal('addModal')" style="width:100%; padding:10px; margin-top:10px; background:none; border:none; color:#999;">å…³é—­</button>
        </div>
    </div>

<script>
    // âœ… ä½¿ç”¨æ‚¨æˆªå›¾é‡Œç¡®è®¤è¿‡çš„æ­£ç¡®å¯†é’¥
    const SECRET_KEY = '807e472419b69803';
    const API_SAFE_CODE = '1763939324766666'; 

    // æ—¥å¿—è¾…åŠ©å‡½æ•°
    function log(msg) {
        console.log(msg);
        const box = document.getElementById('debugLog');
        box.style.display = 'block';
        box.innerText = "ã€ç³»ç»Ÿæ—¥å¿—ã€‘\n" + msg;
    }

    // åˆå§‹åŒ–
    try {
        Bmob.initialize(SECRET_KEY, API_SAFE_CODE);
    } catch (e) {
        log("âŒ SDKåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ");
    }

    let allData = [];

    function loadData() {
        const query = Bmob.Query("SalesData");
        query.order("-createdAt");
        query.find().then(res => {
            if(Array.isArray(res)){ 
                allData = res; 
                renderList(); 
                if(allData.length === 0) document.getElementById('gridContainer').innerHTML = `<div class="loading">æš‚æ— å†…å®¹ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’+å‘å¸ƒ</div>`;
            }
        }).catch(err => {
            log("âŒ è¯»å–å¤±è´¥: " + JSON.stringify(err));
        });
    }

    function renderList() {
        const container = document.getElementById('gridContainer');
        container.innerHTML = '';
        allData.forEach(item => {
            const div = document.createElement('div'); 
            div.className = 'card';
            div.innerHTML = `<span class="card-tag tag-${item.type}">${item.type}</span><div class="card-title">${item.title}</div><div class="card-content">${item.content}</div>`;
            container.appendChild(div);
        });
    }
    
    function saveData() {
        const t = document.getElementById('inputTitle').value;
        const c = document.getElementById('inputContent').value;
        if(!t || !c) return alert('æ ‡é¢˜å†…å®¹å¿…å¡«');

        log("â³ æ­£åœ¨å°è¯•å‘å¸ƒ...");

        const query = Bmob.Query('SalesData');
        query.set("type", document.getElementById('inputType').value);
        query.set("title", t);
        query.set("content", c);
        query.set("author", document.getElementById('inputAuthor').value || "åŒ¿å");
        
        query.save().then(res => { 
            alert('âœ… å‘å¸ƒæˆåŠŸï¼'); 
            closeModal('addModal'); 
            loadData(); 
            document.getElementById('debugLog').style.display = 'none'; // æˆåŠŸåˆ™éšè—æ—¥å¿—
        }).catch(err => {
            // ğŸ”´ è¿™é‡Œä¼šå‘Šè¯‰æˆ‘ä»¬åˆ°åº•å“ªé‡Œé”™äº†
            log("âŒ å‘å¸ƒå¤±è´¥ï¼\né”™è¯¯ä»£ç : " + err.code + "\né”™è¯¯ä¿¡æ¯: " + err.error);
            if(err.code == 403) alert("æƒé™ä¸è¶³ï¼è¯·çœ‹ä¸‹æ–‡ä¿®å¤æ•™ç¨‹");
            if(err.code == 401) alert("å¯†é’¥/å®‰å…¨ç é”™è¯¯ï¼");
        });
    }
    
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    
    loadData();
</script>
</body>
</html>
