<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é”€å”®æ™ºåº“</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://unpkg.com/bmob.js-sdk-pro@3.2.3/dist/model/bmob-min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: #333; margin: 0; padding: 20px; padding-top: 60px; }
        .search-box { position: fixed; top: 0; left: 0; right: 0; z-index: 50; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 10px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; gap: 10px; align-items: center; }
        .search-input { flex: 1; border: none; background: #f1f5f9; padding: 10px 15px; border-radius: 20px; font-size: 15px; }
        .search-input:focus { outline: none; background: #e2e8f0; }
        .add-btn { background: var(--primary); color: #fff; border: none; width: 36px; height: 36px; border-radius: 50%; font-size: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .filter-scroll { display: flex; gap: 8px; overflow-x: auto; padding: 5px 0 15px 0; -webkit-overflow-scrolling: touch; }
        .filter-scroll::-webkit-scrollbar { display: none; }
        .filter-btn { white-space: nowrap; padding: 6px 14px; border-radius: 20px; font-size: 13px; background: #fff; border: 1px solid #e2e8f0; color: #64748b; transition: 0.2s; }
        .filter-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); font-weight: bold; }
        .card { background: #fff; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); position: relative; transition: 0.2s; }
        .card:active { transform: scale(0.98); }
        .delete-btn { position: absolute; top: 15px; right: 15px; color: #cbd5e1; font-size: 14px; padding: 5px; }
        .card-tag { font-size: 10px; padding: 3px 8px; border-radius: 4px; margin-bottom: 8px; display: inline-block; font-weight: bold;}
        .tag-æˆäº¤æ¡ˆä¾‹ { background: #dcfce7; color: #166534; }
        .tag-å¤§å•æ€è·¯ { background: #fef9c3; color: #854d0e; }
        .tag-ç–‘è™‘è§£ç­” { background: #fee2e2; color: #991b1b; }
        .tag-è¯æœ¯æŠ€å·§ { background: #dbeafe; color: #1e40af; }
        .card-title { font-size: 16px; font-weight: 700; color: #1e293b; margin-bottom: 6px; line-height: 1.4; }
        .card-content { font-size: 14px; color: #64748b; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .card-footer { margin-top: 10px; font-size: 12px; color: #94a3b8; display: flex; justify-content: space-between; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 100; display: none; align-items: flex-end; }
        .modal { background: #fff; width: 100%; height: 85vh; border-radius: 20px 20px 0 0; padding: 25px; overflow-y: auto; animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .form-control { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 16px; background: #f8fafc; }
        textarea.form-control { height: 180px; resize: none; line-height: 1.6; }
        .btn-block { width: 100%; padding: 14px; background: var(--primary); color: #fff; border:none; border-radius: 10px; font-size: 16px; font-weight: bold; }
        .detail-content { font-size: 17px; line-height: 1.7; color: #333; white-space: pre-wrap; padding-bottom: 80px; }
        .loading { text-align: center; padding: 50px; color: #94a3b8; }
    </style>
</head>
<body>
    <div class="search-box">
        <input type="text" class="search-input" placeholder="ğŸ” æœé—®é¢˜..." id="searchInput" oninput="loadData()">
        <button class="add-btn" onclick="openModal('addModal')">+</button>
    </div>
    <div class="filter-scroll">
        <div class="filter-btn active" onclick="setFilter('all', this)">å…¨éƒ¨</div>
        <div class="filter-btn" onclick="setFilter('ç–‘è™‘è§£ç­”', this)">â“ ç–‘è™‘è§£ç­”</div>
        <div class="filter-btn" onclick="setFilter('æˆäº¤æ¡ˆä¾‹', this)">ğŸ† æˆäº¤æ¡ˆä¾‹</div>
        <div class="filter-btn" onclick="setFilter('å¤§å•æ€è·¯', this)">ğŸ’ å¤§å•æ€è·¯</div>
        <div class="filter-btn" onclick="setFilter('è¯æœ¯æŠ€å·§', this)">ğŸ—£ï¸ è¯æœ¯æŠ€å·§</div>
    </div>
    <div id="gridContainer"><div class="loading">æ­£åœ¨è¿æ¥äº‘ç«¯...</div></div>

    <div class="modal-overlay" id="addModal">
        <div class="modal">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="margin:0; font-size:20px;">ğŸ“ å‘å¸ƒç»éªŒ</h2>
                <span onclick="closeModal('addModal')" style="font-size:28px; color:#999;">&times;</span>
            </div>
            <select class="form-control" id="inputType"><option>ç–‘è™‘è§£ç­”</option><option>æˆäº¤æ¡ˆä¾‹</option><option>å¤§å•æ€è·¯</option><option>è¯æœ¯æŠ€å·§</option></select>
            <input type="text" class="form-control" id="inputTitle" placeholder="æ ‡é¢˜">
            <textarea class="form-control" id="inputContent" placeholder="è¯¦ç»†å†…å®¹"></textarea>
            <input type="text" class="form-control" id="inputAuthor" placeholder="åˆ†äº«äºº">
            <button class="btn-block" onclick="saveData()">å‘å¸ƒ</button>
        </div>
    </div>

    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <span class="card-tag" id="detailTag">ç±»å‹</span>
                <span onclick="closeModal('detailModal')" style="font-size:28px; color:#999;">&times;</span>
            </div>
            <h2 id="detailTitle" style="margin:0 0 10px 0; font-size:22px;"></h2>
            <div style="font-size:13px; color:#94a3b8; border-bottom:1px solid #f1f5f9; padding-bottom:15px; margin-bottom:20px;">ğŸ‘¤ <span id="detailAuthor"></span> &nbsp;Â·&nbsp; ğŸ•’ <span id="detailTime"></span></div>
            <div id="detailContent" class="detail-content"></div>
            <div style="position:fixed; bottom:30px; left:25px; right:25px;"><button class="btn-block" onclick="copyDetail()">ğŸ“‹ ä¸€é”®å¤åˆ¶</button></div>
        </div>
    </div>

<script>
    // æ‚¨æä¾›çš„Bmobå¯†é’¥å·²å¡«å…¥
    const SECRET_KEY = '807e472419b69803';
    const API_KEY    = '1763939324766666'; 

    Bmob.initialize(SECRET_KEY, API_KEY);
    let allData = []; let currentFilter = 'all';

    function loadData() {
        const query = Bmob.Query("SalesData");
        query.order("-createdAt"); query.limit(500);
        query.find().then(res => { allData = Array.isArray(res) ? res : []; renderList(); })
             .catch(err => { document.getElementById('gridContainer').innerHTML = `<div class="loading">âŒ è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥Bmobåå°</div>`; });
    }
    function renderList() {
        const container = document.getElementById('gridContainer');
        const searchVal = document.getElementById('searchInput').value.toLowerCase();
        const filtered = allData.filter(item => {
            const matchType = currentFilter === 'all' || item.type === currentFilter;
            const matchSearch = (item.title||'').toLowerCase().includes(searchVal) || (item.content||'').toLowerCase().includes(searchVal);
            return matchType && matchSearch;
        });
        container.innerHTML = '';
        if(filtered.length === 0) { container.innerHTML = `<div style="text-align:center; padding:60px; color:#cbd5e1;">æš‚æ— å†…å®¹<br>ç‚¹å‡»å³ä¸Šè§’ + å‘å¸ƒ</div>`; return; }
        filtered.forEach(item => {
            let tagColor = ''; 
            if(item.type==='æˆäº¤æ¡ˆä¾‹') tagColor='tag-æˆäº¤æ¡ˆä¾‹'; if(item.type==='å¤§å•æ€è·¯') tagColor='tag-å¤§å•æ€è·¯';
            if(item.type==='ç–‘è™‘è§£ç­”') tagColor='tag-ç–‘è™‘è§£ç­”'; if(item.type==='è¯æœ¯æŠ€å·§') tagColor='tag-è¯æœ¯æŠ€å·§';
            const div = document.createElement('div'); div.className = 'card';
            div.onclick = (e) => { if(e.target.className !== 'delete-btn') openDetail(item); };
            div.innerHTML = `<div class="delete-btn" onclick="deleteItem('${item.objectId}')">ğŸ—‘ï¸</div><span class="card-tag ${tagColor}">${item.type}</span><div class="card-title">${item.title}</div><div class="card-content">${item.content}</div><div class="card-footer"><span>ğŸ‘¤ ${item.author||'åŒ¿å'}</span><span>${item.createdAt.split(' ')[0]}</span></div>`;
            container.appendChild(div);
        });
    }
    function saveData() {
        const t = document.getElementById('inputTitle').value, c = document.getElementById('inputContent').value;
        if(!t || !c) return alert('æ ‡é¢˜å†…å®¹å¿…å¡«');
        const q = Bmob.Query('SalesData');
        q.set("type", document.getElementById('inputType').value); q.set("title", t); q.set("content", c); q.set("author", document.getElementById('inputAuthor').value || "åŒ¿å");
        q.save().then(res => { alert('å‘å¸ƒæˆåŠŸ'); closeModal('addModal'); document.getElementById('inputTitle').value=''; document.getElementById('inputContent').value=''; loadData(); }).catch(err => alert('å¤±è´¥'));
    }
    function deleteItem(id) { if(confirm('ç¡®å®šåˆ é™¤?')) Bmob.Query('SalesData').destroy(id).then(()=>loadData()); }
    function openDetail(item) {
        const t = document.getElementById('detailTag'); t.innerText = item.type; t.className = `card-tag tag-${item.type}`;
        document.getElementById('detailTitle').innerText = item.title; document.getElementById('detailAuthor').innerText = item.author||'åŒ¿å';
        document.getElementById('detailTime').innerText = item.createdAt; document.getElementById('detailContent').innerText = item.content;
        openModal('detailModal');
    }
    function copyDetail() { navigator.clipboard.writeText(document.getElementById('detailContent').innerText).then(()=>alert('å·²å¤åˆ¶')); }
    function setFilter(t, b) { currentFilter = t; document.querySelectorAll('.filter-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); renderList(); }
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    loadData();
</script>
</body>
</html>
